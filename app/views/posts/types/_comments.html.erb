<div id="comments">
  <h4>Comments</h4>
  
  <%= "<p>No comments have been left yet.</p>" if @post.comments.reject(&:new_record?).blank? %>
  
  <% @post.comments.reject(&:new_record?).each do |comment| -%>
    <% div_for(comment) do %>
    <% if logged_in? -%>
    <small class="right">
      <%= link_to '(delete)', [@post, comment], :method => :delete, :confirm => "Click OK to delete this comment." %>
      <%= link_to '(spam)', article_comment_path(@post, comment, :comment => { :spam => true }), :method => :put %>
    </small>
    <% end -%>
    <h5><%= comment.website.blank? ? h(comment.name) : (link_to h(comment.name), h(comment.website)) %> said... </h5>
      <% if logged_in? %>
      <p><%= link_to h(comment.body), [@post, comment], :class => 'editable', :id => 'comment[body]' %></p>
      <% else -%>
      <p><%= comment.body %></p>
      <% end -%>
    <% end -%>
  <% end -%>  
  
  <% form_for([@post, @comment]) do |f| -%>
  
    <h4>Leave a comment</h4>
  
    <%= error_messages_for :comment, :header_message => nil %>
  
    <% if logged_in? %>
    <%= f.hidden_field :email, :value => current_user.email %>
    <%= f.hidden_field :name, :value => current_user.name %>
    <% else %>
    <label for="email">
      Email <span class="nil">(required)</span><br>
      <%= f.text_field :email, :class => "required" %>
    </label>
  
    <label for="name">
      Name <span class="nil">(required)</span><br>
      <%= f.text_field :name, :class => "required" %>
    </label>
    
    <label for="website">
      Website<br>
      <%= f.text_field :website %>
    </label>
    <% end %>
    
    <label for="body">
      Body <span class="nil">(required)</span><br>
      <%= f.text_area :body, :class => "required" %>
    </label>
    
    <p><%= submit_tag 'Add Comment!' %></p>
  
  <% end -%>
</div>